<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:converters="clr-namespace:DailyReflection.Avalonia.Converters"
             xmlns:vm="clr-namespace:DailyReflection.Presentation.ViewModels;assembly=DailyReflection.Presentation"
             mc:Ignorable="d" d:DesignWidth="400" d:DesignHeight="600"
             x:Class="DailyReflection.Avalonia.Views.DailyReflectionView"
             x:DataType="vm:DailyReflectionViewModel"
             x:Name="ReflectionPage">
    
    <UserControl.Resources>
        <converters:AllFalseMultiConverter x:Key="AllFalseConverter" />
        <converters:InverseBoolConverter x:Key="InverseBoolConverter" />
    </UserControl.Resources>
    
    <Grid RowDefinitions="Auto, *">
        <!-- Toolbar -->
        <Border Grid.Row="0" 
                Background="{StaticResource PrimaryBrush}"
                Padding="12,8">
            <Grid ColumnDefinitions="*, Auto, Auto">
                <TextBlock Text="{Binding Date, StringFormat='{}{0:MMMM d}'}"
                           Foreground="White"
                           FontSize="18"
                           FontWeight="SemiBold"
                           VerticalAlignment="Center" />
                
                <Button Grid.Column="1"
                        Click="SelectDate_Click"
                        Background="Transparent"
                        Foreground="White"
                        ToolTip.Tip="Select Date"
                        Padding="8">
                    <TextBlock Text="ðŸ“…" FontSize="18" />
                </Button>
                
                <Button Grid.Column="2"
                        Command="{Binding ShareCommand}"
                        Background="Transparent"
                        Foreground="White"
                        ToolTip.Tip="Share"
                        Padding="8">
                    <TextBlock Text="ðŸ“¤" FontSize="18" />
                </Button>
            </Grid>
        </Border>
        
        <!-- Content -->
        <ScrollViewer Grid.Row="1" Padding="20">
            <Panel>
                <!-- Main Content -->
                <StackPanel>
                    <StackPanel.IsVisible>
                        <MultiBinding Converter="{StaticResource AllFalseConverter}">
                            <Binding Path="HasError" />
                            <Binding Path="GetDailyReflectionCommand.IsRunning" />
                        </MultiBinding>
                    </StackPanel.IsVisible>
                    
                    <!-- Title -->
                    <TextBlock Text="{Binding DailyReflection.Title}"
                               Classes="Title Center"
                               TextWrapping="Wrap"
                               Margin="0,0,0,20" />
                    
                    <!-- Reading/Quote (HTML text simplified to plain text) -->
                    <TextBlock Text="{Binding DailyReflection.Reading}"
                               Classes="Body Italic Center"
                               TextWrapping="Wrap"
                               Margin="0,0,0,8" />
                    
                    <!-- Source -->
                    <TextBlock Margin="0,0,0,20">
                        <Run Text="â€” " />
                        <Run Text="{Binding DailyReflection.Source}" />
                    </TextBlock>
                    
                    <!-- Thought -->
                    <TextBlock Text="{Binding DailyReflection.Thought}"
                               Classes="Body"
                               TextWrapping="Wrap"
                               Margin="0,0,0,20" />
                    
                    <!-- Copyright -->
                    <TextBlock Classes="Caption"
                               TextWrapping="Wrap">
                        <Run Text="From the book " /><Run Text="Daily Reflections" FontStyle="Italic" />
                        <LineBreak />
                        <Run Text="Copyright Â© 1990 by Alcoholics Anonymous World Services, Inc." />
                    </TextBlock>
                </StackPanel>
                
                <!-- Error State -->
                <TextBlock Text="An error occurred. Please try again."
                           HorizontalAlignment="Center"
                           VerticalAlignment="Center"
                           IsVisible="{Binding HasError}" />
                
                <!-- Loading Indicator -->
                <ProgressBar IsIndeterminate="True"
                             IsVisible="{Binding GetDailyReflectionCommand.IsRunning}"
                             HorizontalAlignment="Center"
                             VerticalAlignment="Center"
                             Width="100" />
            </Panel>
        </ScrollViewer>
        
        <!-- Hidden DatePicker for popup behavior -->
        <CalendarDatePicker x:Name="DatePicker"
                            IsVisible="False"
                            SelectedDateChanged="DatePicker_SelectedDateChanged" />
    </Grid>
</UserControl>
