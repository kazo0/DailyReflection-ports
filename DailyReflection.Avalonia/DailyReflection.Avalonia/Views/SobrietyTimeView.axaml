<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="using:DailyReflection.Presentation.ViewModels"
             xmlns:converters="using:DailyReflection.Avalonia.Converters"
             xmlns:models="using:DailyReflection.Data.Models"
             mc:Ignorable="d" d:DesignWidth="400" d:DesignHeight="600"
             x:Class="DailyReflection.Avalonia.Views.SobrietyTimeView"
             x:DataType="vm:SobrietyTimeViewModel">
    
    <UserControl.Resources>
        <converters:PluralityConverter x:Key="YearsPluralityConverter"
                                       PluralValue="Years"
                                       SingularValue="Year" />
        <converters:PluralityConverter x:Key="MonthsPluralityConverter"
                                       PluralValue="Months"
                                       SingularValue="Month" />
        <converters:PluralityConverter x:Key="DaysPluralityConverter"
                                       PluralValue="Days"
                                       SingularValue="Day" />
        <converters:IsDisplayPreferenceToBoolConverter x:Key="IsDaysMonthsYearsDisplayPreferenceConverter"
                                                       DisplayPreference="DaysMonthsYears" />
        <converters:IsDisplayPreferenceToBoolConverter x:Key="IsDaysOnlyDisplayPreferenceConverter"
                                                       DisplayPreference="DaysOnly" />
        <converters:NullToBoolConverter x:Key="NullToBoolConverter" />
        <converters:IntToBoolConverter x:Key="IntToBoolConverter" />
    </UserControl.Resources>
    
    <Grid RowDefinitions="Auto, *">
        <!-- Header -->
        <Border Grid.Row="0" 
                Background="{DynamicResource SystemAccentColor}"
                Padding="16,8">
            <TextBlock Text="Sober Time"
                       FontSize="20"
                       FontWeight="SemiBold"
                       Foreground="White" />
        </Border>
        
        <!-- Content -->
        <ScrollViewer Grid.Row="1">
            <Grid RowDefinitions="20, Auto, *, Auto, Auto, *, Auto"
                  Margin="20">
                
                <!-- Sober Date Display -->
                <StackPanel Grid.Row="1"
                            HorizontalAlignment="Center"
                            IsVisible="{Binding SoberDate, Converter={StaticResource NullToBoolConverter}}">
                    <PathIcon Data="M19,19H5V8H19M16,1V3H8V1H6V3H5C3.89,3 3,3.89 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V5C21,3.89 20.1,3 19,3H18V1"
                              Width="32"
                              Height="32"
                              HorizontalAlignment="Center"
                              Margin="0,0,0,8" />
                    <TextBlock Text="{Binding SoberDate, StringFormat='{}{0:MMM d, yyyy}'}"
                               FontSize="24"
                               FontWeight="Bold"
                               HorizontalAlignment="Center" />
                </StackPanel>
                
                <!-- Sober Time Display -->
                <Grid Grid.Row="3"
                      HorizontalAlignment="Center"
                      VerticalAlignment="Center"
                      IsVisible="{Binding SoberDate, Converter={StaticResource NullToBoolConverter}}">
                    
                    <!-- Days/Months/Years Display -->
                    <Grid ColumnDefinitions="Auto, Auto"
                          RowDefinitions="Auto, Auto, Auto"
                          ColumnSpacing="16"
                          IsVisible="{Binding DisplayPreference, Converter={StaticResource IsDaysMonthsYearsDisplayPreferenceConverter}}">
                        
                        <!-- Years -->
                        <TextBlock Grid.Row="0" Grid.Column="0"
                                   Text="{Binding SoberPeriod.Years}"
                                   FontSize="36"
                                   FontWeight="Bold"
                                   IsVisible="{Binding SoberPeriod.Years, Converter={StaticResource IntToBoolConverter}}" />
                        <TextBlock Grid.Row="0" Grid.Column="1"
                                   Text="{Binding SoberPeriod.Years, Converter={StaticResource YearsPluralityConverter}}"
                                   FontSize="36"
                                   VerticalAlignment="Center"
                                   IsVisible="{Binding SoberPeriod.Years, Converter={StaticResource IntToBoolConverter}}" />
                        
                        <!-- Months -->
                        <TextBlock Grid.Row="1" Grid.Column="0"
                                   Text="{Binding SoberPeriod.Months}"
                                   FontSize="36"
                                   FontWeight="Bold"
                                   IsVisible="{Binding SoberPeriod.Months, Converter={StaticResource IntToBoolConverter}}" />
                        <TextBlock Grid.Row="1" Grid.Column="1"
                                   Text="{Binding SoberPeriod.Months, Converter={StaticResource MonthsPluralityConverter}}"
                                   FontSize="36"
                                   VerticalAlignment="Center"
                                   IsVisible="{Binding SoberPeriod.Months, Converter={StaticResource IntToBoolConverter}}" />
                        
                        <!-- Days -->
                        <TextBlock Grid.Row="2" Grid.Column="0"
                                   Text="{Binding SoberPeriod.Days}"
                                   FontSize="36"
                                   FontWeight="Bold"
                                   IsVisible="{Binding SoberPeriod.Days, Converter={StaticResource IntToBoolConverter}}" />
                        <TextBlock Grid.Row="2" Grid.Column="1"
                                   Text="{Binding SoberPeriod.Days, Converter={StaticResource DaysPluralityConverter}}"
                                   FontSize="36"
                                   VerticalAlignment="Center"
                                   IsVisible="{Binding SoberPeriod.Days, Converter={StaticResource IntToBoolConverter}}" />
                    </Grid>
                    
                    <!-- Days Only Display -->
                    <Grid ColumnDefinitions="Auto, Auto"
                          ColumnSpacing="16"
                          IsVisible="{Binding DisplayPreference, Converter={StaticResource IsDaysOnlyDisplayPreferenceConverter}}">
                        <TextBlock Grid.Column="0"
                                   Text="{Binding TotalDaysSober}"
                                   FontSize="48"
                                   FontWeight="Bold"
                                   IsVisible="{Binding TotalDaysSober, Converter={StaticResource IntToBoolConverter}}" />
                        <TextBlock Grid.Column="1"
                                   Text="{Binding TotalDaysSober, Converter={StaticResource DaysPluralityConverter}}"
                                   FontSize="48"
                                   VerticalAlignment="Center"
                                   IsVisible="{Binding TotalDaysSober, Converter={StaticResource IntToBoolConverter}}" />
                    </Grid>
                </Grid>
                
                <!-- One Day at a Time -->
                <TextBlock Grid.Row="4"
                           Text="One day at a time"
                           FontStyle="Italic"
                           FontSize="18"
                           HorizontalAlignment="Center"
                           Opacity="0.7"
                           Margin="0,20,0,0" />
            </Grid>
        </ScrollViewer>
    </Grid>
</UserControl>
