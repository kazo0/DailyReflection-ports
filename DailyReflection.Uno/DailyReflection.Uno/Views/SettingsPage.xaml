<?xml version="1.0" encoding="utf-8" ?>
<!--
	SettingsPage
	Migrated from MAUI SettingsView.xaml to WinUI/Uno Platform Page
	
	Control Mappings:
	- ContentPage -> Page
	- TableView/TableSection -> StackPanel with headers (no direct equivalent)
	- SwitchCell -> ToggleSwitch
	- TextCell -> Custom layout with TextBlock
	- Picker -> ComboBox
	- DatePicker -> CalendarDatePicker
	- TimePicker -> TimePicker
-->
<Page x:Class="DailyReflection.Views.SettingsPage"
	  xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
	  xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
	  xmlns:converters="using:DailyReflection.Converters"
	  xmlns:vm="using:DailyReflection.Presentation.ViewModels"
	  Background="{ThemeResource ApplicationPageBackgroundThemeBrush}">

	<Page.Resources>
		<converters:DateTimeToTimeSpanConverter x:Key="DateTimeToTimeSpan" />
		<converters:SoberTimeDisplayEnumConverter x:Key="SoberTimeDisplayEnumConverter" />
	</Page.Resources>

	<ScrollViewer>
		<StackPanel Margin="16"
					Spacing="8">

			<!-- Daily Notifications Section -->
			<TextBlock Text="Daily Notifications"
					   Style="{StaticResource SubtitleTextStyle}"
					   Margin="0,0,0,8" />

			<!-- Enable Notifications Toggle -->
			<Grid Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
				  CornerRadius="4"
				  Padding="16,12">
				<Grid.ColumnDefinitions>
					<ColumnDefinition Width="*" />
					<ColumnDefinition Width="Auto" />
				</Grid.ColumnDefinitions>

				<TextBlock Text="Enable Notifications"
						   VerticalAlignment="Center"
						   Style="{StaticResource BodyTextStyle}" />
				<ToggleSwitch Grid.Column="1"
							  IsOn="{x:Bind ViewModel.NotificationsEnabled, Mode=TwoWay}"
							  Margin="0" />
			</Grid>

			<!-- Notification Time -->
			<Grid Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
				  CornerRadius="4"
				  Padding="16,12"
				  IsEnabled="{x:Bind ViewModel.NotificationsEnabled, Mode=OneWay}"
				  Tapped="NotificationTime_Tapped">
				<Grid.ColumnDefinitions>
					<ColumnDefinition Width="*" />
					<ColumnDefinition Width="Auto" />
				</Grid.ColumnDefinitions>

				<StackPanel>
					<TextBlock Text="Time"
							   Style="{StaticResource BodyTextStyle}" />
					<TextBlock Text="{x:Bind FormatNotificationTime(ViewModel.NotificationTime), Mode=OneWay}"
							   Style="{StaticResource CaptionTextStyle}"
							   Foreground="{ThemeResource TextFillColorSecondaryBrush}" />
				</StackPanel>
				<FontIcon Grid.Column="1"
						  Glyph="&#xE76C;"
						  FontSize="14"
						  VerticalAlignment="Center"
						  Foreground="{ThemeResource TextFillColorSecondaryBrush}" />
			</Grid>

			<!-- Hidden TimePicker (shown as flyout) -->
			<TimePicker x:Name="NotificationTimePicker"
						Visibility="Collapsed"
						TimeChanged="NotificationTimePicker_TimeChanged" />

			<!-- Sobriety Time Section -->
			<TextBlock Text="Sobriety Time"
					   Style="{StaticResource SubtitleTextStyle}"
					   Margin="0,16,0,8" />

			<!-- Sober Date -->
			<Grid Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
				  CornerRadius="4"
				  Padding="16,12"
				  Tapped="SoberDate_Tapped">
				<Grid.ColumnDefinitions>
					<ColumnDefinition Width="*" />
					<ColumnDefinition Width="Auto" />
				</Grid.ColumnDefinitions>

				<StackPanel>
					<TextBlock Text="Sober Date"
							   Style="{StaticResource BodyTextStyle}" />
					<TextBlock Text="{x:Bind FormatSoberDate(ViewModel.SoberDate), Mode=OneWay}"
							   Style="{StaticResource CaptionTextStyle}"
							   Foreground="{ThemeResource TextFillColorSecondaryBrush}" />
				</StackPanel>
				<FontIcon Grid.Column="1"
						  Glyph="&#xE76C;"
						  FontSize="14"
						  VerticalAlignment="Center"
						  Foreground="{ThemeResource TextFillColorSecondaryBrush}" />
			</Grid>

			<!-- Hidden CalendarDatePicker (shown as flyout) -->
			<CalendarDatePicker x:Name="SoberDatePicker"
								Visibility="Collapsed"
								MaxDate="{x:Bind ViewModel.MaxDate, Mode=OneWay}"
								DateChanged="SoberDatePicker_DateChanged" />

			<!-- Sober Time Display Preference -->
			<Grid Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
				  CornerRadius="4"
				  Padding="16,12"
				  Tapped="SoberTimeDisplay_Tapped">
				<Grid.ColumnDefinitions>
					<ColumnDefinition Width="*" />
					<ColumnDefinition Width="Auto" />
				</Grid.ColumnDefinitions>

				<StackPanel>
					<TextBlock Text="Sober Time Display"
							   Style="{StaticResource BodyTextStyle}" />
					<TextBlock Text="{x:Bind ViewModel.SoberTimeDisplayPreference, Mode=OneWay, Converter={StaticResource SoberTimeDisplayEnumConverter}}"
							   Style="{StaticResource CaptionTextStyle}"
							   Foreground="{ThemeResource TextFillColorSecondaryBrush}" />
				</StackPanel>
				<FontIcon Grid.Column="1"
						  Glyph="&#xE76C;"
						  FontSize="14"
						  VerticalAlignment="Center"
						  Foreground="{ThemeResource TextFillColorSecondaryBrush}" />
			</Grid>

			<!-- Hidden ComboBox for display preference -->
			<ComboBox x:Name="SoberTimeDisplayComboBox"
					  Visibility="Collapsed"
					  ItemsSource="{x:Bind ViewModel.AllSoberTimeDisplayPreferences, Mode=OneWay}"
					  SelectedItem="{x:Bind ViewModel.SoberTimeDisplayPreference, Mode=TwoWay}"
					  SelectionChanged="SoberTimeDisplayComboBox_SelectionChanged">
				<ComboBox.ItemTemplate>
					<DataTemplate>
						<TextBlock Text="{Binding Converter={StaticResource SoberTimeDisplayEnumConverter}}" />
					</DataTemplate>
				</ComboBox.ItemTemplate>
			</ComboBox>

			<!-- App Version -->
			<TextBlock Text="About"
					   Style="{StaticResource SubtitleTextStyle}"
					   Margin="0,16,0,8" />

			<Grid Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
				  CornerRadius="4"
				  Padding="16,12">
				<StackPanel>
					<TextBlock Text="Version"
							   Style="{StaticResource BodyTextStyle}" />
					<TextBlock Text="{x:Bind AppVersion, Mode=OneWay}"
							   Style="{StaticResource CaptionTextStyle}"
							   Foreground="{ThemeResource TextFillColorSecondaryBrush}" />
				</StackPanel>
			</Grid>
		</StackPanel>
	</ScrollViewer>
</Page>